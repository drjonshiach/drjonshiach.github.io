

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Runge-Kutta Methods &#8212; My Jupyter Book</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/mystnb.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-2 bd-sidebar site-navigation show single-page" id="site-navigation">
    
</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/2_runge_kutta_methods.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/2_runge_kutta_methods.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#learning-outcomes">
   Learning outcomes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#butcher-tableau">
   Butcher tableau
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#explicit-and-implicit-runge-kutta-methods">
   Explicit and implicit Runge-Kutta methods
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#butcher-tableau-for-explicit-and-implicit-runge-kutta-methods">
   Butcher tableau for explicit and implicit Runge-Kutta methods
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#derivation-of-a-second-order-explicit-runge-kutta-method">
   Derivation of a second-order explicit Runge-Kutta method
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-1">
     Example 1
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#use-of-explicit-runge-kutta-methods-to-solve-initial-value-problems">
   Use of Explicit Runge-Kutta Methods to solve Initial Value Problems
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-2">
     Example 2
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-3">
     Example 3
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#derivation-of-a-fourth-order-explicit-runge-kutta-method">
   Derivation of a fourth-order explicit Runge-Kutta method
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-4">
     Example 4
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-5">
     Example 5
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-6">
     Example 6
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   Exercises
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="runge-kutta-methods">
<h1>Runge-Kutta Methods<a class="headerlink" href="#runge-kutta-methods" title="Permalink to this headline">¶</a></h1>
<div class="section" id="learning-outcomes">
<h2>Learning outcomes<a class="headerlink" href="#learning-outcomes" title="Permalink to this headline">¶</a></h2>
<p>On successful completion of this page readers will be able to:</p>
<ul class="simple">
<li><p>Identify a Runge-Kutta method and express it using a <a class="reference external" href="#Butcher-tableau">Butcher tableau</a>;</p></li>
<li><p>Distinguish between <a class="reference external" href="#Butcher-tableau-for-explicit-and-implicit-Runge-Kutta-methods">explicit and implicit Runge-Kutta methods</a>;</p></li>
<li><p>Derive an <a class="reference external" href="#Derivation-of-a-second-order-explicit-Runge-Kutta-method">explicit Runge-Kutta method</a> using the order conditions;</p></li>
<li><p>Apply explicit Runge-Kutta methods to <a class="reference external" href="#Use-of-Explicit-Runge-Kutta-Methods-to-solve-Initial-Value-Problems">solve an initial value problem</a>.</p></li>
</ul>
<p><a id="runge_kutta_methods"></a><a class="reference external" href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods">Runge-Kutta methods</a> are a family of numerical methods for solving a first-order <a class="reference external" href="https://en.wikipedia.org/wiki/Ordinary_differential_equation">Ordinary Differential Equation</a> (ODE). The general form of a Runge-Kutta method for solving the ODE <span class="math notranslate nohighlight">\(y'=f(t, y)\)</span> is</p>
<div class="math notranslate nohighlight" id="equation-rk-yn">
<span class="eqno">(1)<a class="headerlink" href="#equation-rk-yn" title="Permalink to this equation">¶</a></span>\[y_{n+1} = y_n + h\sum_{i=1}^s b_i k_i,\]</div>
<div class="math notranslate nohighlight" id="equation-rk-ki">
<span class="eqno">(2)<a class="headerlink" href="#equation-rk-ki" title="Permalink to this equation">¶</a></span>\[k_i = f(t_n + c_ih, y_n + h\displaystyle\sum_{j=1}^s a_{ij} k_j).\]</div>
<p>where <span class="math notranslate nohighlight">\(t_n\)</span> is some value of the independent variable <span class="math notranslate nohighlight">\(t\)</span>, <span class="math notranslate nohighlight">\(y_n=y(t_n)\)</span> is the value of the function <span class="math notranslate nohighlight">\(y\)</span> when <span class="math notranslate nohighlight">\(t=t_n\)</span>, <span class="math notranslate nohighlight">\(h=t_{n+1}-t_n\)</span> is the <strong>step length</strong> between two successive values of <span class="math notranslate nohighlight">\(t\)</span>. Runge-Methods are called <strong>single step methods</strong> because the solution over a single step <span class="math notranslate nohighlight">\(y_{n+1}\)</span> is updated by equation <a class="reference internal" href="#equation-rk-yn">(1)</a> using information from the single step <span class="math notranslate nohighlight">\(y_n\)</span>. The other type of method for solving ODEs are <a class="reference external" href="https://en.wikipedia.org/wiki/Linear_multistep_method"><strong>multistep methods</strong></a> that calculate <span class="math notranslate nohighlight">\(y_{n+1}\)</span> using information from multiple steps <span class="math notranslate nohighlight">\(y_n, y_{n-1}, y_{n-2}, \ldots\)</span> Equation <a class="reference internal" href="#equation-rk-ki">(2)</a> calculates intermediate <strong>stage values</strong> <span class="math notranslate nohighlight">\(k_i\)</span> where <span class="math notranslate nohighlight">\(s\)</span> is the number of stages of the method. The number of stages of a Runge-Kutta method will depend upon the order of the method.</p>
</div>
<div class="section" id="butcher-tableau">
<h2>Butcher tableau<a class="headerlink" href="#butcher-tableau" title="Permalink to this headline">¶</a></h2>
<p>A common method used to express a Runge-Kutta method is to use a <strong>Butcher tableau</strong>. Expanding the summations of the general form of a Runge-Kutta method</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
    y_{n+1} &amp;= y_n + h(b_1 k_1 + b_2 k_2 + \cdots + b_s k_s), \\
    k_1 &amp;= f(t_1 + c_1 h, y_n + h(a_{11} k_1 + a_{12} k_2 + \cdots + a_{1s} k_s), \\
    k_2 &amp;= f(t_2 + c_2 h, y_n + h(a_{21} k_1 + a_{22} k_2 + \cdots + a_{2s} k_s), \\
    &amp;\vdots \\
    k_s &amp;= f(t_s + c_s h, y_n + h(a_{s1} k_1 + a_{s2} k_2 + \cdots + a_{ss} k_s).
\end{aligned}
\end{split}\]</div>
<p>It is the values of the coefficients <span class="math notranslate nohighlight">\(a_{ij}\)</span>, <span class="math notranslate nohighlight">\(b_i\)</span> and <span class="math notranslate nohighlight">\(c_i\)</span> that define a particular Runge-Kutta method and these values are arranged in tabular form as follows</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{c|cccc}
c_1 &amp; a_{11} &amp; a_{12} &amp; \cdots &amp; a_{1s} \\
c_2 &amp; a_{21} &amp; a_{22} &amp; \cdots &amp; a_{2s} \\
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
c_s &amp; a_{s1} &amp; a_{s2} &amp; \cdots &amp; a_{ss} \\ \hline
&amp; b_1 &amp; b_2 &amp; \cdots &amp; b_s
\end{array}\end{split}\]</div>
</div>
<div class="section" id="explicit-and-implicit-runge-kutta-methods">
<h2>Explicit and implicit Runge-Kutta methods<a class="headerlink" href="#explicit-and-implicit-runge-kutta-methods" title="Permalink to this headline">¶</a></h2>
<p>The stage values of a general Runge-Kutta method are</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
    k_1 &amp;= f(t_1 + c_1 h, y_n + h(a_{11} k_1 + a_{12} k_2 + \cdots + a_{1s} k_s), \\
    k_2 &amp;= f(t_2 + c_2 h, y_n + h(a_{21} k_1 + a_{22} k_2 + \cdots + a_{2s} k_s), \\
    &amp;\vdots \\
    k_s &amp;= f(t_s + c_s h, y_n + h(a_{s1} k_1 + a_{s2} k_2 + \cdots + a_{ss} k_s).
\end{aligned}
\end{split}\]</div>
<p>Here the equation for calculating the value of <span class="math notranslate nohighlight">\(k_1\)</span> includes <span class="math notranslate nohighlight">\(k_1\)</span> on the right-hand side and similar for <span class="math notranslate nohighlight">\(k_2, k_3, \ldots, k_s\)</span>. These are examples of <strong>implicit</strong> equations and Runge-Kutta methods where the stage values are expressed using implicit equations are known as <strong>Implicit Runge-Kutta</strong> (IRK) methods. To calculate the solution of the stage values of an IRK method involves solving a system of equations which is computationally expensive.</p>
<p>If the summation in equation <a class="reference external" href="#rk">(2)</a> is altered so the upper limit to the sum is <span class="math notranslate nohighlight">\(i-1\)</span> term, i.e.,</p>
<div class="math notranslate nohighlight">
\[k_i = f(t_n + c_ih, y_n + h\sum_{j=1}^{i-1} a_{ij} k_j),\]</div>
<p>and let <span class="math notranslate nohighlight">\(c_1=0\)</span> then we have the following equations for calculating the stage values</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
    k_1 &amp;= f(t_n, y_n), \\
    k_2 &amp;= f(t_n + c_2h, y_n + h a_{21} k_1), \\
    k_3 &amp;= f(t_n + c_3h, y_n + h (a_{31} k_1 + a_{32} k_2)), \\
    &amp;\vdots \\
    k_s &amp;= f(t_n + c_sh, y_n + h (a_{s1} k_1 + a_{s2} k_2 + \cdots + a_{s,s-1} k_{s-1})).
\end{aligned}
\end{split}\]</div>
<p>These stages values are <strong>explicit</strong> equations where the subject of the equation does not appear on the right-hand side. Runge-Kutta methods where the stages values are calculated using explicit equations are known as <strong>Explicit Runge Kutta</strong> (ERK) methods. Note that we can calculate the stage values in order, i.e., <span class="math notranslate nohighlight">\(k_1\)</span> can be calculated using <span class="math notranslate nohighlight">\(t_n\)</span> and <span class="math notranslate nohighlight">\(y_n\)</span>; <span class="math notranslate nohighlight">\(k_2\)</span> can be calculated using <span class="math notranslate nohighlight">\(t_n\)</span>, <span class="math notranslate nohighlight">\(y_n\)</span> and <span class="math notranslate nohighlight">\(k_1\)</span>; <span class="math notranslate nohighlight">\(k_3\)</span> can be calculated using <span class="math notranslate nohighlight">\(t_n\)</span>, <span class="math notranslate nohighlight">\(y_n\)</span>, <span class="math notranslate nohighlight">\(k_1\)</span> and <span class="math notranslate nohighlight">\(k_2\)</span> and so on. This means that ERK methods as more computationally efficient than IRK methods, however in certain situations ERK methods cannot be used and we must then use IRK methods (see <span class="xref myst">Implicit Runge-Kutta Methods</span>).</p>
</div>
<div class="section" id="butcher-tableau-for-explicit-and-implicit-runge-kutta-methods">
<h2>Butcher tableau for explicit and implicit Runge-Kutta methods<a class="headerlink" href="#butcher-tableau-for-explicit-and-implicit-runge-kutta-methods" title="Permalink to this headline">¶</a></h2>
<p>ERK and IRK methods can be easily distinguished looking at the Butcher tableau. The <span class="math notranslate nohighlight">\(A\)</span> matrix in the top right region of a Butcher tableau for an ERK method (left) is lower-triangular whereas for an IRK method (right) the main-diagonal and upper triangular elements are non-zero.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\begin{array}{c|cccc}
0 &amp;  \\
c_2 &amp; a_{21} \\
c_3 &amp; a_{31} &amp; a_{32} \\
\vdots &amp; \vdots &amp; \vdots &amp; \ddots  \\
c_s &amp; a_{s1} &amp; a_{s2} &amp; \cdots &amp; a_{s,s-1} \\ \hline
&amp; b_1 &amp; b_2 &amp; \cdots &amp; b_{s-1} &amp; b_s
\end{array}
&amp;&amp;&amp;&amp;
\begin{array}{c|cccc}
c_1 &amp; a_{11} &amp; a_{12} &amp; a_{13} &amp; \cdots &amp; a_{1s} \\
c_2 &amp; a_{21} &amp; a_{22} &amp; a_{23} &amp; \cdots &amp; a_{2s} \\
c_3 &amp; a_{31} &amp; a_{32} &amp; a_{33} &amp; \cdots &amp; a_{3s} \\
\vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
c_s &amp; a_{s1} &amp; a_{s2} &amp; a_{s3} &amp; \cdots &amp; a_{ss} \\ \hline
&amp; b_1 &amp; b_2 &amp; b_3 &amp; \cdots &amp; b_s
\end{array}
\end{aligned}
\end{split}\]</div>
</div>
<hr class="docutils" />
<div class="section" id="derivation-of-a-second-order-explicit-runge-kutta-method">
<h2>Derivation of a second-order explicit Runge-Kutta method<a class="headerlink" href="#derivation-of-a-second-order-explicit-runge-kutta-method" title="Permalink to this headline">¶</a></h2>
<p>A Runge-Kutta method is derived by comparing the <a class="reference external" href="https://en.wikipedia.org/wiki/Taylor_series">Taylor series</a> of the general Runge-Kutta method and ensuring the coefficients <span class="math notranslate nohighlight">\(a_{ij}\)</span>, <span class="math notranslate nohighlight">\(b_i\)</span> and <span class="math notranslate nohighlight">\(c_i\)</span> match those of the Taylor series expansion of the ODE <span class="math notranslate nohighlight">\(y'=f(t, y)\)</span>.</p>
<p>The second-order Taylor series expansion of <span class="math notranslate nohighlight">\(y(t+h)\)</span> is</p>
<div class="math notranslate nohighlight">
\[y_{n+1} = y + hy' + \frac{h^2}{2}y''.\]</div>
<p>Since <span class="math notranslate nohighlight">\(y' = f(t, y)\)</span> and applying the <a class="reference external" href="https://en.wikipedia.org/wiki/Chain_rule">chain rule</a> to differentiate <span class="math notranslate nohighlight">\(y'\)</span> we have</p>
<div class="math notranslate nohighlight">
\[y'' = f_t(t, y) + f_y(t, y)f(t, y),\]</div>
<p>then the Taylor series becomes</p>
<div class="math notranslate nohighlight">
\[
y_{n+1} = y + hf(t, y) + \frac{h^2}{2}(f_t(t, y) + f_y(t, y)f(t, y)),
\]</div>
<p>which can be written as</p>
<div class="math notranslate nohighlight" id="equation-2nd-order-taylor">
<span class="eqno">(3)<a class="headerlink" href="#equation-2nd-order-taylor" title="Permalink to this equation">¶</a></span>\[y_{n+1} = y + \frac{h}{2}f(t, y) + \frac{h}{2}(f(t, y) + hf_t(t, y) + hf_y(t, y)f(t,y)).\]</div>
<p>Equation <a class="reference internal" href="#equation-2nd-order-taylor">(3)</a> is the second-order Taylor series expansion for the ODE <span class="math notranslate nohighlight">\(y'=f(t, y)\)</span>. To be consistent, the Taylor series expansion of a numerical method must be equivalent to this.</p>
<p>The general form of a second-order Runge-Kutta method is</p>
<div class="math notranslate nohighlight" id="equation-general-rk2">
<span class="eqno">(4)<a class="headerlink" href="#equation-general-rk2" title="Permalink to this equation">¶</a></span>\[y_{n+1} = y_n + h b_1 f(t_n, y_n) + h b_2 f(t + c_2h, y + h a_{21} f(t_n, y_n)).\]</div>
<p>To write this in a form comparable to equation <a class="reference internal" href="#equation-2nd-order-taylor">(3)</a> we can use the first-order bivariate Taylor series which is</p>
<div class="math notranslate nohighlight">
\[f(t + h, y + k) = f(t, y) + h f_t(t, y) + k f(t, y) f_y(t, y),\]</div>
<p>so the Taylor series expansion of <span class="math notranslate nohighlight">\(f(t_n + c_2h, y_n + h a_{21} f(t_n, y_n))\)</span> is</p>
<div class="math notranslate nohighlight">
\[f(t_n + c_2h, y_n + h a_{21} f(t_n,y_n)) = f(t_n, y_n) + h c_2 f_t(t_n, y_n) + h a_{21} f(t_n, y_n) f_y(t_n, y_n),\]</div>
<p>which is substituted into equation <a class="reference internal" href="#equation-general-rk2">(4)</a> to give</p>
<div class="math notranslate nohighlight" id="equation-rk-taylor">
<span class="eqno">(5)<a class="headerlink" href="#equation-rk-taylor" title="Permalink to this equation">¶</a></span>\[y_{n+1} = y_n + h b_1 f(t_n, y_n) + h b_2 (f(t_n, y_n) + h c_2 f_t(t_n, y_n) + h a_{21} f(t_n, y_n) f_y(t_n, y_n)).\]</div>
<p>Equating <a class="reference internal" href="#equation-2nd-order-taylor">(3)</a> and <a class="reference internal" href="#equation-rk-taylor">(5)</a> we see that</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
    b_1 + b_2 &amp;= 1, \\
    c_2b_2 &amp;= \frac{1}{2}, \\
    a_{21}b_2 &amp;= \frac{1}{2}.
\end{aligned}
\end{split}\]</div>
<p>Here we have a system of 3 equations expressed in the 4 unknowns <span class="math notranslate nohighlight">\(b_1\)</span>, <span class="math notranslate nohighlight">\(b_2\)</span>, <span class="math notranslate nohighlight">\(c_2\)</span> and <span class="math notranslate nohighlight">\(a_{21}\)</span>. These equations are known as the <strong>order conditions</strong> for a second-order Runge-Kutta method. To derive a second-order ERK method we choose a value for one of these coefficients and solve for the others.</p>
<div class="section" id="example-1">
<h3>Example 1<a class="headerlink" href="#example-1" title="Permalink to this headline">¶</a></h3>
<p>Derive an ERK method where <span class="math notranslate nohighlight">\(c_2 = 1\)</span>.</p>
<p>The code below uses the <code class="docutils literal notranslate"><span class="pre">solve</span></code> command from the <code class="docutils literal notranslate"><span class="pre">sympy</span></code> library to solve the order conditions for a second-order ERK method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Initialise symbolic variables</span>
<span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">a21</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;b1, b2, c2, a21&#39;</span><span class="p">)</span>
<span class="n">c2</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Define order conditions</span>
<span class="n">eqn1</span> <span class="o">=</span> <span class="n">b1</span> <span class="o">+</span> <span class="n">b2</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">eqn2</span> <span class="o">=</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">b2</span> <span class="o">-</span> <span class="n">Rational</span><span class="p">(</span><span class="s1">&#39;1 / 2&#39;</span><span class="p">)</span>
<span class="n">eqn3</span> <span class="o">=</span> <span class="n">a21</span> <span class="o">*</span> <span class="n">b2</span> <span class="o">-</span> <span class="n">Rational</span><span class="p">(</span><span class="s1">&#39;1 / 2&#39;</span><span class="p">)</span>

<span class="c1"># Solve system</span>
<span class="n">solve</span><span class="p">((</span><span class="n">eqn1</span><span class="p">,</span> <span class="n">eqn2</span><span class="p">,</span> <span class="n">eqn3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>[{a21: 1, b1: 1/2, b2: 1/2}]
</pre></div>
</div>
</div>
</div>
<p>So <span class="math notranslate nohighlight">\(a_{21}=1\)</span> and <span class="math notranslate nohighlight">\(b_1=b_2=\frac{1}{2}\)</span> so this second-order ERK method is</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
y_{n+1} &amp;= y_n + \frac{h}{2}(k_1 + k_2), \\
k_1 &amp;= f(t_n, y_n), \\
k_2 &amp;= f(t_n + h, y_n + h k_1),
\end{aligned}
\end{split}\]</div>
<p>or expressed using a Butcher tableau</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{c|cc}
0 &amp;  \\
1 &amp; 1 &amp;  \\ \hline
&amp; \frac{1}{2} &amp; \frac{1}{2}
\end{array}\end{split}\]</div>
<p>This Runge-Kutta method is known as <em>the</em> second-order Runge-Kutta method or RK2 for short.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="use-of-explicit-runge-kutta-methods-to-solve-initial-value-problems">
<h2>Use of Explicit Runge-Kutta Methods to solve Initial Value Problems<a class="headerlink" href="#use-of-explicit-runge-kutta-methods-to-solve-initial-value-problems" title="Permalink to this headline">¶</a></h2>
<p>Runge-Kutta methods are used to solve <a class="reference external" href="https://en.wikipedia.org/wiki/Initial_value_problem">Initial Value Problems</a> (IVP) of the form</p>
<p>\begin{align*}
y’ &amp;= f(t, y), &amp; t &amp;\in [t_{\min}, t_{\max}], &amp; y(t_{\min}) &amp;= y_0,
\end{align*}</p>
<p>where <span class="math notranslate nohighlight">\(y'=f(t,y)\)</span> is a first-order ODE defined over the domain <span class="math notranslate nohighlight">\(t\in [t_{\min}, t_{\max}]\)</span> and the initial solution <span class="math notranslate nohighlight">\(y(t_{\min})\)</span> is the known value <span class="math notranslate nohighlight">\(y_0\)</span>.</p>
<p>To apply the an ERK method to solve an IVP we calculate the stage values <span class="math notranslate nohighlight">\(k_1\)</span> and <span class="math notranslate nohighlight">\(k_2\)</span> using the known values of <span class="math notranslate nohighlight">\(t_n\)</span>, <span class="math notranslate nohighlight">\(y_n\)</span> and the step length <span class="math notranslate nohighlight">\(h\)</span> substituted into the ODE function <span class="math notranslate nohighlight">\(f(t, y)\)</span>. Then the solution over one step <span class="math notranslate nohighlight">\(t_{n+1} = t_n + h\)</span> and <span class="math notranslate nohighlight">\(y_{n+1} = y(t_{n+1})\)</span> is then calculated using <span class="math notranslate nohighlight">\(k_1, k_2, \ldots, k_s\)</span>.</p>
<div class="section" id="example-2">
<h3>Example 2<a class="headerlink" href="#example-2" title="Permalink to this headline">¶</a></h3>
<p>Calculate the first two steps of the <a class="reference external" href="#rk2">RK2 method</a> to solve the following IVP</p>
<p>\begin{aligned}
y’ &amp;= \sin^2(t)y, &amp; t &amp;\in [0, 5], &amp; y(0) &amp;= 1.
\end{aligned}</p>
<p>using a step length of <span class="math notranslate nohighlight">\(h=0.5\)</span>.</p>
<p>Step 1: <span class="math notranslate nohighlight">\(t_0=0\)</span> and <span class="math notranslate nohighlight">\(y_0=1\)</span></p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
    k_1 &amp;= \sin^2(t_0)y_0  = \sin^2(0)(1) = 0, \\
    k_2 &amp;=  \sin^2(t_0 + h)(y_0 + hk_1) = \sin^2(0 + 0.5)(1 + 0.5(0)) = 0.2298, \\
    y_1 &amp;= y_0 + \frac{h}{2}(k_1 + k_2) = 1 + \frac{0.5}{2}(0 + 0.2298) = 1.0575, \\
    t_1 &amp;= t_0 + h = 0 + 0.5 = 0.5.
\end{aligned}
\end{split}\]</div>
<p>Step 2: <span class="math notranslate nohighlight">\(t_1 = 0.5\)</span> and <span class="math notranslate nohighlight">\(y_1 = 1.0575\)</span></p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
    k_1 &amp;= \sin^2(t_1)y_1 = \sin^2(0.5)(1.0575) = 0.2431, \\
    k_2 &amp;= \sin^2(t_1 + h)(y_1 + hk_1) = \sin^2(0.5 + 0.5)(1.0575 + 0.5(0.2431)) = 0.8348, \\
    y_2 &amp;= y_1 + \frac{h}{2}(k_1 + k_2) = 1.0575 + \frac{0.5}{2}(0.2431 + 0.8349) = 1.3269.
\end{aligned}
\end{split}\]</div>
</div>
<div class="section" id="example-3">
<h3>Example 3<a class="headerlink" href="#example-3" title="Permalink to this headline">¶</a></h3>
<p>Calculate the solution of the IVP from <a class="reference external" href="#Example-2">example 2</a> over the whole domain <span class="math notranslate nohighlight">\(t\in [0,5]\)</span> using the Euler method with a step length of <span class="math notranslate nohighlight">\(h=0.5\)</span> and compare it to the exact solution given by</p>
<div class="math notranslate nohighlight">
\[y = e^{(t - \sin(t)\cos(t))/2}\]</div>
<p>The functions below defines the right-hand side of the ODE and the exact solution to the IVP.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">y</span>

<span class="k">def</span> <span class="nf">exact_sol</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>The code below defines a function <code class="docutils literal notranslate"><span class="pre">rk2</span></code> that solves an IVP using the RK2 method. The input arguments are <code class="docutils literal notranslate"><span class="pre">f</span></code> is the name of the function the defines the ODE, <code class="docutils literal notranslate"><span class="pre">tspan</span></code> is a two-element array containing the lower and upper bounds of the <span class="math notranslate nohighlight">\(t\)</span> domain, <code class="docutils literal notranslate"><span class="pre">y0</span></code> is the initial value of <span class="math notranslate nohighlight">\(y\)</span> at the lower bound and <code class="docutils literal notranslate"><span class="pre">h</span></code> is the step length.
<a id="rk2_code"></a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rk2</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">tspan</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculates the solution to an IVP using the second-order Runge-Kutta method</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Initialise solution arrays</span>
    <span class="n">nsteps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">tspan</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">tspan</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">h</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsteps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsteps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">tspan</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y0</span>

    <span class="c1"># Solver loop</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsteps</span><span class="p">):</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="n">k2</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span> <span class="o">*</span> <span class="n">k1</span><span class="p">)</span>
        <span class="n">y</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="n">k2</span><span class="p">)</span>
        <span class="n">t</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span>

    <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span>
</pre></div>
</div>
</div>
</div>
<p>The program below invokes the RK2 method to solve this IVP and compares it to the exact solution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rc</span>
<span class="n">rc</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Define IVP parameters</span>
<span class="n">tspan</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span> <span class="p">]</span>
<span class="n">y0</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">h</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="c1"># Invoke the RK2 method to solve IVP</span>
<span class="n">t</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">rk2</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">tspan</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

<span class="c1"># Output solution table</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39; t     RK2    Exact</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:3.2f}</span><span class="s1"> </span><span class="si">{:7.4f}</span><span class="s1"> </span><span class="si">{:7.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">exact_sol</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="p">])))</span>

<span class="c1"># Plot solutions</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">tspan</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tspan</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">exact_sol</span><span class="p">(</span><span class="n">t1</span><span class="p">),</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Exact&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;bo-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RK2&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Solution to the IVP $y&#39;=y\sin^2(t)$, $y(0) = 1$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y(t)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span> t     RK2    Exact
--------------------
0.00  1.0000  1.0000
0.50  1.0575  1.0404
1.00  1.3269  1.3135
1.50  2.0088  2.0436
2.00  3.1302  3.2845
2.50  4.1734  4.4359
3.00  4.5716  4.8059
3.50  4.7364  4.8830
4.00  5.6020  5.7699
4.50  8.1257  8.5589
5.00 12.8273 13.9573
</pre></div>
</div>
<img alt="_images/2_runge_kutta_methods_13_1.png" src="_images/2_runge_kutta_methods_13_1.png" />
</div>
</div>
<p>Here we can see that the RK2 solution follows the approximate shape of the exact solution, however, there are still noticeable errors in the numerical solution. Use of a higher order ERK would improve the accuracy of the numerical results.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="derivation-of-a-fourth-order-explicit-runge-kutta-method">
<h2>Derivation of a fourth-order explicit Runge-Kutta method<a class="headerlink" href="#derivation-of-a-fourth-order-explicit-runge-kutta-method" title="Permalink to this headline">¶</a></h2>
<p>The order conditions for a fourth-order ERK method are</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
    b_1 + b_2 + b_3 + b_4 &amp;= 1, \\
    b_2c_2 + b_3c_3 + b_4c_4 &amp;= \frac{1}{2}, \\
    b_2c_2^2 + b_3c_3^2 + b_4c_4^2 &amp;= \frac{1}{3}, \\
    b_2c_2^3 + b_3c_3^3 + b_4c_4^3 &amp;= \frac{1}{4}, \\
    b_3c_3a_{32}c_2 + b_4c_4(a_{42}c_2 + a_{43}c_3) &amp;= \frac{1}{8}, \\
    b_3a_{32} + b_4a_{42} &amp;= b_2(1 - c_2), \\
    b_4a_{43} &amp;= b_3(1 - c_3), \\
    0 &amp;= b_4(1 - c_4).
\end{aligned}
\end{split}\]</div>
<p>A feature of Runge-Kutta methods is the <strong>row sum condition</strong> that states</p>
<div class="math notranslate nohighlight">
\[c_i = \sum_{j=1}^s a_{ij},\]</div>
<p>i.e., the value of <span class="math notranslate nohighlight">\(c_i\)</span> is equal to the sum of row <span class="math notranslate nohighlight">\(i\)</span> of the matrix <span class="math notranslate nohighlight">\(A\)</span>. Therefore, the values of <span class="math notranslate nohighlight">\(a_{21}\)</span>, <span class="math notranslate nohighlight">\(a_{31}\)</span> and <span class="math notranslate nohighlight">\(a_{41}\)</span> are</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
    c_2 &amp;= a_{21}, \\
    c_3 &amp;= a_{31} + a_{32}, \\
    c_4 &amp;= a_{41} + a_{42} + a_{43}.
\end{aligned}
\end{split}\]</div>
<p>To solve for the unknowns we choose 4 values from <span class="math notranslate nohighlight">\(b_1\)</span>, <span class="math notranslate nohighlight">\(b_2\)</span>, <span class="math notranslate nohighlight">\(b_3\)</span>, <span class="math notranslate nohighlight">\(b_4\)</span>, <span class="math notranslate nohighlight">\(c_2\)</span>, <span class="math notranslate nohighlight">\(c_3\)</span> and <span class="math notranslate nohighlight">\(c_4\)</span> and solve the order conditions for the remaining unknowns.</p>
<div class="section" id="example-4">
<h3>Example 4<a class="headerlink" href="#example-4" title="Permalink to this headline">¶</a></h3>
<p>Derive a fourth-order Runge-Kutta method where <span class="math notranslate nohighlight">\(c_2 = c_3 = \frac{1}{2}\)</span> and <span class="math notranslate nohighlight">\(c_4=1\)</span> and <span class="math notranslate nohighlight">\(b_2=\frac{1}{3}\)</span>.</p>
<p>The code below defines and solves the order conditions and row sum conditions for a fourth-order ERK method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialise symbolic variables</span>
<span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">b3</span><span class="p">,</span> <span class="n">b4</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;b1, b2, b3, b4&#39;</span><span class="p">)</span>
<span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c4</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;c2, c3, c4&#39;</span><span class="p">)</span>
<span class="n">a31</span><span class="p">,</span> <span class="n">a32</span><span class="p">,</span> <span class="n">a41</span><span class="p">,</span> <span class="n">a42</span><span class="p">,</span> <span class="n">a43</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">(</span><span class="s1">&#39;a31, a32, a41, a42, a43&#39;</span><span class="p">)</span>
<span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c4</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">Rational</span><span class="p">(</span><span class="s1">&#39;1 / 2&#39;</span><span class="p">),</span> <span class="n">Rational</span><span class="p">(</span><span class="s1">&#39;1 / 2&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Rational</span><span class="p">(</span><span class="s1">&#39;1 / 3&#39;</span><span class="p">)</span>

<span class="c1"># Define order conditions</span>
<span class="n">eqn1</span> <span class="o">=</span> <span class="n">b1</span> <span class="o">+</span> <span class="n">b2</span> <span class="o">+</span> <span class="n">b3</span> <span class="o">+</span> <span class="n">b4</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">eqn2</span> <span class="o">=</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">c2</span> <span class="o">+</span> <span class="n">b3</span> <span class="o">*</span> <span class="n">c3</span> <span class="o">+</span> <span class="n">b4</span> <span class="o">*</span> <span class="n">c4</span> <span class="o">-</span> <span class="n">Rational</span><span class="p">(</span><span class="s1">&#39;1 / 2&#39;</span><span class="p">)</span>
<span class="n">eqn3</span> <span class="o">=</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">c2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b3</span> <span class="o">*</span> <span class="n">c3</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b4</span> <span class="o">*</span> <span class="n">c4</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">Rational</span><span class="p">(</span><span class="s1">&#39;1 / 3&#39;</span><span class="p">)</span>
<span class="n">eqn4</span> <span class="o">=</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">c2</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">b3</span> <span class="o">*</span> <span class="n">c3</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">b4</span> <span class="o">*</span> <span class="n">c4</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="n">Rational</span><span class="p">(</span><span class="s1">&#39;1 / 4&#39;</span><span class="p">)</span>
<span class="n">eqn5</span> <span class="o">=</span> <span class="n">b3</span> <span class="o">*</span> <span class="n">c3</span> <span class="o">*</span> <span class="n">a32</span> <span class="o">*</span> <span class="n">c2</span> <span class="o">+</span> <span class="n">b4</span> <span class="o">*</span> <span class="n">c4</span> <span class="o">*</span> <span class="p">(</span><span class="n">a42</span> <span class="o">*</span> <span class="n">c2</span> <span class="o">+</span> <span class="n">a43</span> <span class="o">*</span> <span class="n">c3</span><span class="p">)</span> <span class="o">-</span> <span class="n">Rational</span><span class="p">(</span><span class="s1">&#39;1 / 8&#39;</span><span class="p">)</span>
<span class="n">eqn6</span> <span class="o">=</span> <span class="n">b3</span> <span class="o">*</span> <span class="n">a32</span> <span class="o">+</span> <span class="n">b4</span> <span class="o">*</span> <span class="n">a42</span> <span class="o">-</span> <span class="n">b2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c2</span><span class="p">)</span>
<span class="n">eqn7</span> <span class="o">=</span> <span class="n">b4</span> <span class="o">*</span> <span class="n">a43</span> <span class="o">-</span> <span class="n">b3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c3</span><span class="p">)</span>
<span class="n">eqn8</span> <span class="o">=</span> <span class="n">b4</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c4</span><span class="p">)</span>
<span class="n">eqn9</span> <span class="o">=</span> <span class="n">c2</span> <span class="o">-</span> <span class="n">a21</span>
<span class="n">eqn10</span> <span class="o">=</span> <span class="n">c3</span> <span class="o">-</span> <span class="n">a31</span> <span class="o">-</span> <span class="n">a32</span>
<span class="n">eqn11</span> <span class="o">=</span> <span class="n">c4</span> <span class="o">-</span> <span class="n">a41</span> <span class="o">-</span> <span class="n">a42</span> <span class="o">-</span> <span class="n">a43</span>

<span class="c1"># Solve system</span>
<span class="n">solve</span><span class="p">((</span><span class="n">eqn1</span><span class="p">,</span> <span class="n">eqn2</span><span class="p">,</span> <span class="n">eqn3</span><span class="p">,</span> <span class="n">eqn4</span><span class="p">,</span> <span class="n">eqn5</span><span class="p">,</span> <span class="n">eqn6</span><span class="p">,</span> <span class="n">eqn7</span><span class="p">,</span> <span class="n">eqn8</span><span class="p">,</span> <span class="n">eqn9</span><span class="p">,</span> <span class="n">eqn10</span><span class="p">,</span> <span class="n">eqn11</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-none notranslate"><div class="highlight"><pre><span></span>[{a21: 1/2,
  a31: 0,
  a32: 1/2,
  a41: 0,
  a42: 0,
  a43: 1,
  b1: 1/6,
  b3: 1/3,
  b4: 1/6}]
</pre></div>
</div>
</div>
</div>
<p>So <span class="math notranslate nohighlight">\(a_{21} = \frac{1}{2}\)</span>, <span class="math notranslate nohighlight">\(a_{31} = 0\)</span>, <span class="math notranslate nohighlight">\(a_{32} = \frac{1}{2}\)</span>, <span class="math notranslate nohighlight">\(a_{41} = 0\)</span>, <span class="math notranslate nohighlight">\(a_{42} = 0\)</span>, <span class="math notranslate nohighlight">\(a_{43} = 1\)</span>, <span class="math notranslate nohighlight">\(b_1 = \frac{1}{6}\)</span>, <span class="math notranslate nohighlight">\(b_3 = \frac{1}{3}\)</span> and <span class="math notranslate nohighlight">\(b_4 = \frac{1}{6}\)</span> and the method is</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
    y_{n+1} &amp;= y_n + \frac{h}{6}(k_1 + 2  k_2 + 2  k_3 + k_4), \\
    k_1 &amp;= f(t_n, y_n), \\
    k_2 &amp;= f(t_n + \tfrac{1}{2}h, y_n + \tfrac{1}{2}hk_1), \\
    k_3 &amp;= f(t_n + \tfrac{1}{2}h, y_n + \tfrac{1}{2}hk_2), \\
    k_4 &amp;= f(t_n + h, y_n + hk_3),
\end{aligned}
\end{split}\]</div>
<p>or as a Butcher tableau</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{c|cccc}
0 &amp; \\
\frac{1}{2} &amp; \frac{1}{2} \\
\frac{1}{2} &amp; 0 &amp; \frac{1}{2} \\
1 &amp; 0 &amp; 0 &amp; 1 \\ \hline
&amp; \frac{1}{6} &amp; \frac{1}{3} &amp; \frac{1}{3} &amp; \frac{1}{6}
\end{array}\end{split}\]</div>
<p>This fourth-order ERK is often referred to as <em>the</em> Runge-Kutta method or RK4 for short.</p>
</div>
<div class="section" id="example-5">
<h3>Example 5<a class="headerlink" href="#example-5" title="Permalink to this headline">¶</a></h3>
<p>Calculate the first two steps of the RK4 method to calculate the solution of the IVP in <a class="reference external" href="#Example-2">example 2</a> using a step length of <span class="math notranslate nohighlight">\(h=0.5\)</span></p>
<p>\begin{align*}
y’ &amp;= \sin^2(t)y, &amp; t &amp;\in [0, 5], &amp; y(0) &amp;= 1.
\end{align*}</p>
<p>Step 1: <span class="math notranslate nohighlight">\(t_0 = 0\)</span> and <span class="math notranslate nohighlight">\(y_0 = 1\)</span></p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
    k_1 &amp;= \sin^2(t_0)y_0  = 1 \sin^2(0) = 0, \\
    k_2 &amp;= \sin^2(t_0 + \tfrac{1}{2} h)(y_0 + \tfrac{1}{2} h k_1)  = \sin^2(0 + \tfrac{1}{2} (0.5))(1 + \tfrac{1}{2} (0.5))  = 0.0612, \\
    k_3 &amp;= \sin^2(t_0 + \tfrac{1}{2} h)(y_0 + \tfrac{1}{2} h k_2) = \sin^2(0 + \frac{1}{2}(0.5))(1 + \tfrac{1}{2} (0.5) (0.0612)) = 0.0631, \\
    k_4 &amp;= \sin^2(t_0 + h)(y_0 + h k_3) = \sin^2(0 + 0.5)(1 + 0.5 (0.0621)) = 0.2443, \\
    y_1 &amp;= y_0 + \frac{h}{6}(k_1 + 2k_2 + 2k_3 + k_4) = 1 + \frac{0.5}{6}(0 + 2(0.0612) + 2(0.0621) + 0.2370) = 1.0411, \\
    t_1 &amp;= t_0 + h = 0 + 0.5 = 0.5.
\end{aligned}
\end{split}\]</div>
<p>Step 2: <span class="math notranslate nohighlight">\(t_1 = 0.5\)</span> and <span class="math notranslate nohighlight">\(y_1 = 1.0411\)</span></p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
    k_1 &amp;= \sin^2(t_1)y_1 = 1.0411 \sin^2(0.5) = 0.2393, \\
    k_2 &amp;= \sin^2(t_1 + \tfrac{1}{2}h)(y_1 + \tfrac{1}{2}hk_1) = \sin^2(0.5 + \tfrac{1}{2}(0.5))(1.0411 + \tfrac{1}{2}(0.5)(0.2393)) = 0.5393, \\
    k_3 &amp;= \sin^2(t_1 + \tfrac{1}{2}h)(y_1 + \tfrac{1}{2}hk_2) = \sin^2(0.5 + \tfrac{1}{2}(0.5))(1.0411 + \tfrac{1}{2}(0.5)(0.5393)) = 0.6090, \\
    k_4 &amp;= \sin^2(t_1 + h)(y_1 + hk_3) = \sin^2(0.5 + 0.5)(1.0411 + (0.5)(0.6090)) = 1.1684, \\
    y_2 &amp;= y_1 + \frac{h}{6}(k_1 + 2k_2 + 2k_3 + k_4) = 1.0411 + \frac{0.5}{6}(0.2393 + 2(0.5393) + 2(0.6090) + 1.1684) = 1.3498, \\
    t_2 &amp;= t_1 + h = 0.5 + 0.5 = 1.0.
\end{aligned}
\end{split}\]</div>
</div>
<div class="section" id="example-6">
<h3>Example 6<a class="headerlink" href="#example-6" title="Permalink to this headline">¶</a></h3>
<p>Calculate the solution of the IVP from <a class="reference external" href="#Example-2">example 2</a> over the domain <span class="math notranslate nohighlight">\(t\in [0,5]\)</span> using the RK4 method with a step length of <span class="math notranslate nohighlight">\(h=0.5\)</span> and compare the solution to the exact solution and the one obtained using the RK2 method.</p>
<p>The code below defines a function <code class="docutils literal notranslate"><span class="pre">rk4</span></code> that solves an IVP using the fourth-order explicit Runge-Kutta method using the same input arguments as the <a class="reference external" href="#rk2_code"><code class="docutils literal notranslate"><span class="pre">rk2</span></code></a> function defined earlier.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">rk4</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">tspan</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculates the solution to an IVP using the fourth-order explicit Runge-Kutta method</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Initialise solution arrays</span>
    <span class="n">nsteps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">tspan</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">tspan</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">h</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsteps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsteps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">tspan</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y0</span>
    
    <span class="c1"># Solver loop</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsteps</span><span class="p">):</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="n">k2</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">h</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">h</span> <span class="o">*</span> <span class="n">k1</span><span class="p">)</span>
        <span class="n">k3</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">h</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">h</span> <span class="o">*</span> <span class="n">k2</span><span class="p">)</span>
        <span class="n">k4</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span> <span class="o">*</span> <span class="n">k3</span><span class="p">)</span>
        <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">6</span> <span class="o">*</span> <span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">k2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">k3</span> <span class="o">+</span> <span class="n">k4</span><span class="p">)</span>
        <span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">h</span>
    
    <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span>
</pre></div>
</div>
</div>
</div>
<p>The program below invokes the RK2 and RK4 methods to solve this IVP and compares their solutions to the exact solution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define IVP parameters</span>
<span class="n">tspan</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">5</span> <span class="p">]</span>
<span class="n">y0</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">h</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="c1"># Solve the IVP using the RK2 and RK4 methods</span>
<span class="n">t1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">rk2</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">tspan</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
<span class="n">t2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">rk4</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">tspan</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

<span class="c1"># Output solution table</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39; t     RK2     RK4    Exact</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">28</span><span class="p">)</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:3.2f}</span><span class="s1"> </span><span class="si">{:7.4f}</span><span class="s1"> </span><span class="si">{:7.4f}</span><span class="s1"> </span><span class="si">{:7.4f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t1</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">y1</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">y2</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">exact_sol</span><span class="p">(</span><span class="n">t1</span><span class="p">[</span><span class="n">n</span><span class="p">])))</span>

<span class="c1"># Plot solutions</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">t3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">tspan</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tspan</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t3</span><span class="p">,</span> <span class="n">exact_sol</span><span class="p">(</span><span class="n">t3</span><span class="p">),</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Exact solution&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="s1">&#39;bo-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RK4&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="s1">&#39;ro-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RK4&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Solution to the IVP $y&#39;=\sin^2(t)y$, $y(0) = 1$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y(t)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span> t     RK2     RK4    Exact
----------------------------
0.00  1.0000  1.0000  1.0000
0.50  1.0575  1.0403  1.0404
1.00  1.3269  1.3133  1.3135
1.50  2.0088  2.0430  2.0436
2.00  3.1302  3.2830  3.2845
2.50  4.1734  4.4338  4.4359
3.00  4.5716  4.8032  4.8059
3.50  4.7364  4.8795  4.8830
4.00  5.6020  5.7656  5.7699
4.50  8.1257  8.5517  8.5589
5.00 12.8273 13.9431 13.9573
</pre></div>
</div>
<img alt="_images/2_runge_kutta_methods_23_1.png" src="_images/2_runge_kutta_methods_23_1.png" />
</div>
</div>
<p>The solution computed by the RK4 method shows very good agreement with the exact solutions. Whilst it is possible to derive higher-order Runge-Kutta methods, in practice the increased accuracy you get is not worth the additional computational cost. The RK4 method is considered the default ODE solver.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="#Runge-Kutta-Methods">Runge-Kutta methods</a> are single step methods that use intermediate stage values to advance the solution over a small step of length <span class="math notranslate nohighlight">\(h\)</span> using known values of <span class="math notranslate nohighlight">\(t_n\)</span> and <span class="math notranslate nohighlight">\(y_n\)</span> to calculate <span class="math notranslate nohighlight">\(y_{n+1}=y(t_n + h)\)</span>.</p></li>
<li><p>Runge-Kutta methods are commonly expressed in tabular form called a <a class="reference external" href="#Butcher-tableau">Butcher tableau</a>.</p></li>
<li><p>There are two types of Runge-Kutta methods: <a class="reference external" href="#Explicit-and-implicit-Runge-Kutta-methods">explicit and implicit</a>.</p></li>
<li><p>The coefficients of a Runge-Kutta methods are chosen to satisfy the <a class="reference external" href="#Derivation-of-a-fourth-order-explicit-Runge-Kutta-method">order conditions</a> which are derived by comparing the Taylor series expansion to the general form of the Runge-Kutta method to the equivalent Taylor series expansion of the first-order ODE <span class="math notranslate nohighlight">\(y'=f(t, y)\)</span>.</p></li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p>Write the following Runge-Kutta method in a Butcher tableau.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
    y_{n+1} &amp;= y_n + \frac{h}{6}(k_1 + 4k_3 + k_4), \\
    k_1 &amp;= f(t_n, y_n), \\
    k_2 &amp;= f(t_n + \tfrac{1}{4}h, y_n + \tfrac{1}{4}hk_1), \\
    k_3 &amp;= f(t_n + \tfrac{1}{2}h, y_n + \tfrac{1}{2}hk_2), \\
    k_4 &amp;= f(t_n + h, y_n + h(k_1 - 2k_2 + 2k_3)).
\end{aligned}
\end{split}\]</div>
</li>
<li><p>Write out the equations for the following Runge-Kutta method.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{c|cccc}
    0 \\
    \frac{1}{4} &amp; \frac{1}{4} \\
    \frac{1}{2} &amp; -\frac{1}{2} &amp; 1 \\
    1 &amp; \frac{1}{4} &amp; 0 &amp; \frac{3}{4} \\ \hline
    &amp; 0 &amp; \frac{4}{9} &amp; \frac{1}{3} &amp; \frac{2}{9}
\end{array}
\end{split}\]</div>
</li>
<li><p>Derive an explicit second-order Runge-Kutta method such that <span class="math notranslate nohighlight">\(b_1 = \tfrac{1}{3}\)</span>. Express your solution as a Butcher tableau.</p></li>
<li><p>Derive an explicit fourth-order Runge-Kutta method such that <span class="math notranslate nohighlight">\(b_1=0\)</span> and <span class="math notranslate nohighlight">\(c_2 = \tfrac{1}{5}\)</span>. Write your answer in the form of a Butcher tableau.</p></li>
<li><p>Using pen and a calculator and working to 4 decimal places, apply your Runge-Kutta method derived in question 3 to solve the following IVP using a step length of <span class="math notranslate nohighlight">\(h=0.4\)</span></p>
<div class="math notranslate nohighlight">
\[y' = ty, \qquad t \in [0, 2], \qquad y(0) = 1. \]</div>
</li>
<li><p>Repeat question 5 using the RK4 method (the RK4 method is derived in <a class="reference external" href="#Example-4">example 4</a>).</p></li>
<li><p>Repeat question 5 using Python. The exact solution to this IVP is <span class="math notranslate nohighlight">\(y=e^{t^2/2}\)</span>. Produce a table comparing the numerical and exact solutions. Produce a plot of the numerical solutions and exact solution on the same set of axes.</p></li>
</ol>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The Jupyter Book community<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="_static/js/index.js"></script>
    
  </body>
</html>